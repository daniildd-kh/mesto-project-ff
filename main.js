(()=>{"use strict";var t={authorizationId:"bb5266d4-5809-4721-906b-67da4b3c928b",cohortId:"wff-cohort-3",url:"https://mesto.nomoreparties.co/v1/"};function e(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(res.status))}var o=document.querySelector("#card-template").content;function n(t){t.target.closest(".card").remove()}function r(t){t.target.classList.toggle("card__like-button_is-active")}function c(n,r,c,a,u){var i=o.querySelector(".card").cloneNode(!0),l=i.querySelector(".card__like-button"),s=i.querySelector(".card__image");if(u===n.owner._id){var p=i.querySelector(".card__delete-button");p.classList.add("card__delete-button_visible"),p.addEventListener("click",(function(o){var c;(c=n._id,fetch("".concat(t.url).concat(t.cohortId,"/cards/").concat(c),{method:"DELETE",headers:{authorization:t.authorizationId,"Content-Type":"application/json"}}).then((function(t){return e(t)}))).then(r(o)).catch((function(t){console.log("Ошибка ".concat(t))}))}))}n.likes.some((function(t){return t._id===u}))&&l.classList.toggle("card__like-button_is-active"),l.addEventListener("click",(function(o){var r;o.target.classList.contains("card__like-button_is-active")?(r=n._id,fetch("".concat(t.url).concat(t.cohortId,"/cards/likes/").concat(r),{method:"DELETE",headers:{authorization:t.authorizationId,"Content-Type":"application/json"}}).then((function(t){return e(t)}))).then((function(t){f.textContent=t.likes.length,c(o)})).catch((function(t){console.log("Ошибка ".concat(t))})):function(o){return fetch("".concat(t.url).concat(t.cohortId,"/cards/likes/").concat(o),{method:"PUT",headers:{authorization:t.authorizationId,"Content-Type":"application/json"}}).then((function(t){return e(t)}))}(n._id).then((function(t){f.textContent=t.likes.length,c(o)})).catch((function(t){console.log("Ошибка ".concat(t))}))})),s.addEventListener("click",a);var d=i.querySelector(".card__title"),_=i.querySelector(".card__image"),f=i.querySelector(".card__like-count");return d.textContent=n.name,_.src=n.link,_.alt=n.name,f.textContent=n.likes.length,i}function a(t){t.classList.add("popup_is-opened"),document.addEventListener("keydown",i)}function u(t){t.classList.remove("popup_is-opened"),document.removeEventListener("keydown",i)}function i(t){if("Escape"===t.key){var e=document.querySelector(".popup_is-opened");e&&u(e)}}function l(t,e,o){!function(t){return t.some((function(t){return!t.validity.valid}))}(t)?(e.disabled=!1,e.classList.remove(o.inactiveButtonClass)):(e.disabled=!0,e.classList.add(o.inactiveButtonClass))}function s(t,e,o){var n=t.querySelector(".".concat(e.id,"-error"));n.textContent="",n.classList.remove(o.errorClass),e.classList.remove(o.inputErrorClass)}function p(t,e){var o=Array.from(t.querySelectorAll(e.inputSelector));l(o,t.querySelector(e.submitButtonSelector),e),o.forEach((function(o){s(t,o,e),o.setCustomValidity("")}))}var d=document.querySelector(".profile__title"),_=document.querySelector(".profile__description"),f=document.querySelector(".profile__image"),m=document.querySelector(".profile__edit-button"),h=document.querySelector(".popup_type_edit"),y=h.querySelector(".popup__button"),v=h.querySelector(".popup__form"),S=document.querySelector(".popup__input_type_name"),b=document.querySelector(".popup__input_type_description"),q=document.querySelector(".places__list"),g=document.querySelector(".popup_type_image"),C=document.querySelector(".popup__image"),E=document.querySelector(".popup__caption"),L=document.querySelector(".profile__add-button"),k=document.querySelector(".popup_type_new-card"),I=k.querySelector(".popup__button"),z=k.querySelector(".popup__form"),x=document.querySelector(".popup__input_type_card-name"),T=document.querySelector(".popup__input_type_url"),A=document.querySelector(".popup_type_edit-avatar"),j=A.querySelector(".popup__button"),B=A.querySelector(".popup__form"),w=document.querySelector(".popup__input_type_avatar-url"),P=document.querySelectorAll(".popup"),D={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};function N(t){C.src=t.target.src,C.alt=t.target.alt,E.textContent=t.target.alt,a(g)}function O(t,e){e.textContent=t?"Сохранение...":"Сохранить"}function J(o){var n;o.preventDefault(),O(!0,y),(n={name:S.value,about:b.value},fetch("".concat(t.url).concat(t.cohortId,"/users/").concat("me"),{method:"PATCH",headers:{authorization:t.authorizationId,"Content-Type":"application/json"},body:JSON.stringify(n)}).then((function(t){return e(t)}))).then((function(t){d.textContent=t.name,_.textContent=t.about,u(h)})).catch((function(t){console.log(t)})).finally((function(){O(!1,y)}))}function M(o){var n;o.preventDefault(),O(!0,j),(n={avatar:w.value},fetch("".concat(t.url).concat(t.cohortId,"/users/me/avatar"),{method:"PATCH",headers:{authorization:t.authorizationId,"Content-Type":"application/json"},body:JSON.stringify(n)}).then((function(t){return e(t)}))).then((function(t){f.style.backgroundImage="url('".concat(t.avatar,"')"),u(A)})).catch((function(t){console.log(t)})).finally((function(){O(!1,j)}))}function V(o){var a;o.preventDefault(),O(!0,I),(a={name:x.value,link:T.value},fetch("".concat(t.url).concat(t.cohortId,"/cards"),{method:"POST",headers:{authorization:t.authorizationId,"Content-Type":"application/json"},body:JSON.stringify(a)}).then((function(t){return e(t)}))).then((function(t){var e;e=c(t,n,r,N,t.owner._id),q.prepend(e),o.target.reset(),u(k)})).catch((function(t){console.log(t)})).finally((function(){O(!1,I)}))}Promise.all([fetch("".concat(t.url).concat(t.cohortId,"/cards"),{headers:{authorization:t.authorizationId}}).then((function(t){return e(t)})),("me",fetch("".concat(t.url).concat(t.cohortId,"/users/").concat("me"),{headers:{authorization:t.authorizationId}}).then((function(t){return e(t)})))]).then((function(t){var e=t[0],o=t[1];e.forEach((function(t){var e;e=c(t,n,r,N,o._id),q.append(e)})),d.textContent=o.name,_.textContent=o.about,f.style.backgroundImage="url('".concat(o.avatar,"')")})).catch((function(t){console.log("Ошибка ".concat(t))})),P.forEach((function(t){t.classList.add("popup_is-animated"),t.addEventListener("click",(function(e){e.target.classList.contains("popup__close")&&u(t),e.target===e.currentTarget&&u(t)}))})),m.addEventListener("click",(function(){a(h),S.value=d.textContent,b.value=_.textContent,v.addEventListener("submit",J),p(v,D)})),f.addEventListener("click",(function(){a(A),B.reset(),B.addEventListener("submit",M),p(B,D)})),L.addEventListener("click",(function(){z.reset(),a(k),z.addEventListener("submit",V),p(z,D)})),function(t){Array.from(document.querySelectorAll(t.formSelector)).forEach((function(e){!function(t,e){var o=Array.from(t.querySelectorAll(e.inputSelector)),n=t.querySelector(e.submitButtonSelector);l(o,n,e),o.forEach((function(r){r.addEventListener("input",(function(){!function(t,e,o){e.validity.patternMismatch?e.setCustomValidity(e.dataset.errorMessage):e.setCustomValidity(""),e.validity.valid?s(t,e,o):function(t,e,o,n){var r=t.querySelector(".".concat(e.id,"-error"));r.textContent=o,r.classList.add(n.errorClass),e.classList.add(n.inputErrorClass)}(t,e,e.validationMessage,o)}(t,r,e),l(o,n,e)}))}))}(e,t)}))}({formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"})})();