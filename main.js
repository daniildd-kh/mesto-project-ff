(()=>{"use strict";var t={authorizationId:"bb5266d4-5809-4721-906b-67da4b3c928b",cohortId:"wff-cohort-3"};function e(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(res.status))}var o=document.querySelector("#card-template").content;function n(t){t.target.closest(".card").remove()}function r(t){t.target.classList.toggle("card__like-button_is-active")}function c(n,r,c,a,i){var u=o.querySelector(".card").cloneNode(!0),s=u.querySelector(".card__like-button"),l=u.querySelector(".card__image");if(i===n.owner._id){var p=u.querySelector(".card__delete-button");p.classList.add("card__delete-button_visible"),p.addEventListener("click",(function(o){var c;c=n._id,fetch("https://mesto.nomoreparties.co/v1/".concat(t.cohortId,"/cards/").concat(c),{method:"DELETE",headers:{authorization:t.authorizationId,"Content-Type":"application/json"}}).then((function(t){return e(t)})),r(o)}))}n.likes.some((function(t){return t._id===i}))&&s.classList.toggle("card__like-button_is-active"),s.addEventListener("click",(function(o){var r;o.target.classList.contains("card__like-button_is-active")?(r=n._id,fetch("https://mesto.nomoreparties.co/v1/".concat(t.cohortId,"/cards/likes/").concat(r),{method:"DELETE",headers:{authorization:t.authorizationId,"Content-Type":"application/json"}}).then((function(t){return e(t)}))).then((function(t){m.textContent=t.likes.length,c(o)})):function(o){return fetch("https://mesto.nomoreparties.co/v1/".concat(t.cohortId,"/cards/likes/").concat(o),{method:"PUT",headers:{authorization:t.authorizationId,"Content-Type":"application/json"}}).then((function(t){return e(t)}))}(n._id).then((function(t){m.textContent=t.likes.length,c(o)}))})),l.addEventListener("click",a);var d=u.querySelector(".card__title"),_=u.querySelector(".card__image"),m=u.querySelector(".card__like-count");return d.textContent=n.name,_.src=n.link,_.alt=n.name,m.textContent=n.likes.length,u}function a(t){t.classList.add("popup_is-opened"),document.addEventListener("keydown",u)}function i(t){t.classList.remove("popup_is-opened"),document.removeEventListener("keydown",u)}function u(t){if("Escape"===t.key){var e=document.querySelector(".popup_is-opened");e&&i(e)}}function s(t,e,o){!function(t){return t.some((function(t){return!t.validity.valid}))}(t)?(e.disabled=!1,e.classList.remove(o.inactiveButtonClass)):(e.disabled=!0,e.classList.add(o.inactiveButtonClass))}function l(t,e,o){var n=t.querySelector(".".concat(e.id,"-error"));n.textContent="",n.classList.remove(o.errorClass),e.classList.remove(o.inputErrorClass)}function p(t,e){var o=Array.from(t.querySelectorAll(e.inputSelector)),n=t.querySelector(e.submitButtonSelector);n.classList.remove(e.inactiveButtonClass),n.disabled=!1,o.forEach((function(o){l(t,o,e),o.setCustomValidity("")}))}var d=document.querySelector(".content"),_=document.querySelector(".profile__title"),m=document.querySelector(".profile__description"),f=document.querySelector(".profile__image"),h=document.querySelector(".popup_type_edit"),v=document.querySelector(".popup__input_type_name"),y=document.querySelector(".popup__input_type_description"),S=document.querySelector(".places__list"),b=document.querySelector(".popup_type_image"),C=document.querySelector(".popup__image"),g=document.querySelector(".popup__caption"),q=document.querySelector(".popup_type_new-card"),L=document.querySelector(".popup__input_type_card-name"),E=document.querySelector(".popup__input_type_url"),k=document.querySelector(".popup_type_edit-avatar"),I=document.querySelector(".popup__input_type_avatar-url"),z=document.querySelectorAll(".popup"),x={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};function T(t){var e=t.target.closest(".card"),o=e.querySelector(".card__image").src,n=e.querySelector(".card__title").textContent;a(b),C.src=o,g.textContent=n}function A(t,e){e.textContent=t?"Сохранение...":"Сохранить"}function B(o){o.preventDefault();var n,r=h.querySelector(".popup__button");A(!0,r),(n={name:v.value,about:y.value},fetch("https://mesto.nomoreparties.co/v1/".concat(t.cohortId,"/users/").concat("me"),{method:"PATCH",headers:{authorization:t.authorizationId,"Content-Type":"application/json"},body:JSON.stringify(n)}).then((function(t){return e(t)}))).then((function(t){_.textContent=t.name,m.textContent=t.about})).catch((function(t){console.log(t)})).finally((function(){A(!1,r)})),i(h)}function j(o){o.preventDefault();var n,r=k.querySelector(".popup__button");A(!0,r),(n={avatar:I.value},fetch("https://mesto.nomoreparties.co/v1/".concat(t.cohortId,"/users/me/avatar"),{method:"PATCH",headers:{authorization:t.authorizationId,"Content-Type":"application/json"},body:JSON.stringify(n)}).then((function(t){return e(t)}))).then((function(t){f.style.backgroundImage="url('".concat(t.avatar,"')")})).catch((function(t){console.log(t)})).finally((function(){A(!1,r)})),i(k)}function w(o){o.preventDefault();var a,u=q.querySelector(".popup__button");A(!0,u),(a={name:L.value,link:E.value},fetch("https://mesto.nomoreparties.co/v1/".concat(t.cohortId,"/cards"),{method:"POST",headers:{authorization:t.authorizationId,"Content-Type":"application/json"},body:JSON.stringify(a)}).then((function(t){return e(t)}))).then((function(t){var e;e=c(t,n,r,T,t.owner._id),S.prepend(e),o.target.reset()})).catch((function(t){console.log(t)})).finally((function(){A(!1,u)})),i(q)}Promise.all([fetch("https://mesto.nomoreparties.co/v1/".concat(t.cohortId,"/cards"),{headers:{authorization:t.authorizationId}}).then((function(t){return e(t)})),("me",fetch("https://mesto.nomoreparties.co/v1/".concat(t.cohortId,"/users/").concat("me"),{headers:{authorization:t.authorizationId}}).then((function(t){return e(t)})))]).then((function(t){var e=t[0],o=t[1];e.forEach((function(t){var e;e=c(t,n,r,T,o._id),S.append(e)})),_.textContent=o.name,m.textContent=o.about,f.style.backgroundImage="url('".concat(o.avatar,"')")})).catch((function(t){console.log("Ошибка ".concat(t))})),z.forEach((function(t){t.classList.add("popup_is-animated"),t.addEventListener("click",(function(e){e.target.classList.contains("popup__close")&&i(t),e.target===e.currentTarget&&i(t)}))})),d.addEventListener("click",(function(t){t.target.classList.contains("profile__edit-button")&&(a(h),v.value=_.textContent,y.value=m.textContent,h.addEventListener("submit",B),p(h,x)),t.target.classList.contains("profile__image")&&(a(k),I.value="",k.addEventListener("submit",j),p(k,x)),t.target.classList.contains("profile__add-button")&&(L.value="",E.value="",a(q),q.addEventListener("submit",w),p(q,x))})),function(t){Array.from(document.querySelectorAll(t.formSelector)).forEach((function(e){!function(t,e){var o=Array.from(t.querySelectorAll(e.inputSelector)),n=t.querySelector(e.submitButtonSelector);s(o,n,e),o.forEach((function(r){r.addEventListener("input",(function(){!function(t,e,o){e.validity.patternMismatch?e.setCustomValidity(e.dataset.errorMessage):e.setCustomValidity(""),e.validity.valid?l(t,e,o):function(t,e,o,n){var r=t.querySelector(".".concat(e.id,"-error"));r.textContent=o,r.classList.add(n.errorClass),e.classList.add(n.inputErrorClass)}(t,e,e.validationMessage,o)}(t,r,e),s(o,n,e)}))}))}(e,t)}))}({formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"})})();